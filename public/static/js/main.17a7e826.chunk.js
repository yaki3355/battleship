(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{166:function(t,e,n){"use strict";n.r(e);var r=n(11),i=n.n(r),a=n(13),o=n(64),c=n(14),s=n(211),u=n(212),l=n(213),h=n(168),j=n(203),f=n(210),d=n(215),p=n(110),b=n.n(p),O=n(111),x=n.n(O),m=n(0),v=n(18),y=n(60),g=n(200),k=n(220),w=n(206),B=n(218),A=n(207),S=n(208),M=n(209),T=n(107),C=n.n(T),I=n(108),E=n.n(I),D=n(109),N=n.n(D),H=n(216),G=n(197),W=n(198),P=n(219),R=n(199),J=n(99),L=n.n(J)()(),F=function(t,e,n,r){var i=Object(v.a)(t);return i[e]=Object(v.a)(i[e]),i[e][n]=r,i},U=[5,4,3,3,2],Y=function(t){for(var e=0,n=t.length-1;e<n;++e){var r=Math.floor(Math.random()*(t.length-e-1))+e+1,i=t[e];t[e]=t[r],t[r]=i}return t},z={getUpdatedMatrix:F,hit:function(t,e,n,r,i,a,o){if(n){if(i((function(r){return F(r,t,e,n)})),!n.ship)return a(!1);r&&o((function(t){return{you:t.you+1,opponent:t.opponent,lastWinner:"You"}}))}},newBoard:function(t){var e=Object(v.a)(Array(10)).map((function(t){return Object(v.a)(Array(10)).map((function(t){return{backgroundColor:"#03cffc",ship:!1,hit:!1}}))}));return t?X(e):e},shipArr:U,nrow:10,ncol:10,shuffleArr:Y},X=function(t){return U.forEach((function(e){q(t,e)})),t},q=function(t,e){for(var n=function(){var n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),i=Y([[-1,0],[0,1],[1,0],[0,-1]]).find((function(i){return Object(v.a)(Array(e)).every((function(e,a){return K(t,n+i[0]*a,r+i[1]*a)}))}));return i?(Object(v.a)(Array(e)).forEach((function(e,a){return t[n+i[0]*a][r+i[1]*a].ship=!0})),"break"):"continue"};;){var r=n();if("continue"!==r&&"break"===r)break}},K=function(t,e,n){return e>=0&&e<t.length&&n>=0&&n<t[e].length&&!t[e][n].ship&&[[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1]].every((function(r){var i=e+r[0],a=n+r[1];return i<0||a<0||i>=t.length||a>=t[i].length||!t[i][a].ship}))},Q=n(100),V=n(101),Z=function(){function t(){Object(Q.a)(this,t)}return Object(V.a)(t,[{key:"find",value:function(e,n){var r=this,i=z.shuffleArr([].concat(Object(v.a)(t.verArr),Object(v.a)(t.horArr))).map((function(i){return{str:i,potential:r.countByDir(e,n,t.directions[i]),hit:0}})).filter((function(t){return t.potential>0}));return!!this.enoughPotential(i)&&(this.start=[e,n],this.dirs=i,this.totalHit=0,!0)}},{key:"enoughPotential",value:function(e){var n=this.sumPotential(e,t.verArr),r=this.sumPotential(e,t.horArr),i=Math.max(n,r);return t.shipArr.some((function(t){return t&&i>=t}))}},{key:"sumPotential",value:function(t,e){return t.filter((function(t){return e.includes(t.str)})).reduce((function(t,e){return t+e.potential}),1)}},{key:"countByDir",value:function(e,n,r){for(var i=-1;this.isClear(e,n);){++i;var o=t.next([e,n],r),c=Object(a.a)(o,2);e=c[0],n=c[1]}return i}},{key:"isClear",value:function(e,n){var r=t.matrixTrack;return t.isInBounds(e,n)&&!r[e][n].hit&&Object.values(t.directions).every((function(i){var o=t.next([e,n],i),c=Object(a.a)(o,2),s=c[0],u=c[1];return!t.isInBounds(s,u)||!r[s][u].ship}))}},{key:"onShip",value:function(){return this.totalHit>0&&this.enoughPotential(this.dirs)}},{key:"nextCoordinates",value:function(){return this.nextNoShip()}},{key:"nextNoShip",value:function(){var e=this.dirs[0],n=t.matrixTrack,r=Object(a.a)(this.start,2),i=r[0],o=r[1];do{var c=t.next([i,o],t.directions[e.str]),s=Object(a.a)(c,2);i=s[0],o=s[1]}while(n[i][o].ship);return[i,o]}},{key:"hit",value:function(e,n){var r=this;if(t.matrixTrack[e][n].hit=!0,t.matrixTrack[e][n].ship=!0,++this.totalHit,!t.shipArr.some((function(t){return t&&t>r.totalHit})))return this.reset();2===this.totalHit&&this.removeIrrelevantDirs(),this.isDirDone()&&this.changeToOpposite()}},{key:"miss",value:function(e,n){if(t.matrixTrack[e][n].hit=!0,0!==this.totalHit)return 1===this.totalHit?this.dirs.shift():void this.changeToOpposite()}},{key:"changeToOpposite",value:function(){var t=this.dirs[0],e=this.getOpposite(t);if(!e)return this.reset();e.potential+=t.hit,e.hit+=t.hit,this.dirs=[e]}},{key:"isDirDone",value:function(){if(1!==this.totalHit){var t=this.dirs[0];return++t.hit===t.potential}}},{key:"removeIrrelevantDirs",value:function(){var t=this.dirs[0],e=this.getOpposite(t);this.dirs=[t,e].filter((function(t){return t}))}},{key:"getOpposite",value:function(e){var n=t.verArr.includes(e.str)?t.verArr:t.horArr,r=1^n.indexOf(e.str);return this.dirs.find((function(t){return t.str===n[r]}))}},{key:"reset",value:function(){var e=t.shipArr;delete e[e.indexOf(this.totalHit)],this.totalHit=0}}],[{key:"isInBounds",value:function(t,e){var n=z.nrow,r=z.ncol;return t>=0&&t<n&&e>=0&&e<r}},{key:"next",value:function(t,e){return[t[0]+e[0],t[1]+e[1]]}}]),t}();Z.directions={up:[-1,0],upRight:[-1,1],right:[0,1],downRight:[1,1],down:[1,0],downLeft:[1,-1],left:[0,-1],upLeft:[-1,-1]},Z.verArr=["up","down"],Z.horArr=["left","right"];var $=Z,_=new $,tt={hitBot:function(t,e,n,r,i){L.emit("hit bot",t,e,(function(a,o){z.hit(t,e,a,o,r,n,i)}))},botHit:function t(e,n,r){setTimeout((function(){var i=et(),o=Object(a.a)(i,2),c=o[0],s=o[1];L.emit("bot hit",c,s,(function(i,a){return i?(n((function(t){return z.getUpdatedMatrix(t,c,s,i)})),i.ship?(_.hit(c,s),a?r((function(t){return{you:t.you,opponent:t.opponent+1,lastWinner:"Bot"}})):void t(e,n,r)):(_.miss(c,s),e(!0))):t(e,n,r)}))}),100)},setBotData:function(t){var e=t.matrixTrack,n=t.shipArr;$.matrixTrack=e,$.shipArr=n}},et=function(){if(_.onShip())return _.nextCoordinates();for(var t=z.nrow,e=z.ncol,n=Math.floor(Math.random()*t),r=Math.floor(Math.random()*e);n<t;n=(n+1)%t){for(;r<e;++r)if(_.find(n,r))return[n,r];r=0}},nt=n(4);function rt(t){var e=t.isMyBoard,n=t.turn,r=t.setTurn,i=t.matrix,a=t.setMyMatrix,o=t.setOpponentMatrix,c=t.setScore,s=t.vsBot;function u(t){var a=t.row;return Object(nt.jsx)(G.a,{children:Object(nt.jsx)(W.a,{children:Object(v.a)(Array(z.ncol)).map((function(t,u){var l=i[a][u],h=l.backgroundColor,j=l.ship,f=l.hit;return Object(nt.jsx)(P.a,{style:{backgroundColor:h,borderWidth:"0.75px",width:"22px",height:"22px"},onClick:function(){if(!e&&!0===n)return s?tt.hitBot(a,u,r,o,c):void L.emit("hit",a,u,(function(t,e){z.hit(a,u,t,e,o,r,c)}))},children:f?"X":j?"*":Object(nt.jsx)(nt.Fragment,{children:"\xa0"})},u)}))})})}return Object(m.useEffect)((function(){L.on("hit",(function(t,n,i,o){if(e&&i){if(a((function(e){return z.getUpdatedMatrix(e,t,n,i)})),!i.ship)return r(!0);o&&c((function(t){return{you:t.you,opponent:t.opponent+1,lastWinner:"Opponent"}}))}}))}),[]),Object(m.useEffect)((function(){s&&!1===n&&tt.botHit(r,a,c)}),[n]),Object(nt.jsx)(R.a,{children:Object(v.a)(Array(z.nrow)).map((function(t,e){return Object(nt.jsx)(u,{row:e},e)}))})}var it=Object(M.a)((function(t){return{root:{flexGrow:1,paddingTop:t.spacing(4)},battlefield:{height:140,width:100},arrow:{marginTop:"65px",position:"absolute"}}})),at=function(t){var e=t.setGameId,n=t.exitBtn,r=t.setExitBtn,i=t.setShowGameId,o=Object(c.f)(),s=o.location,u=s.isOpponentReady,l=s.gameId,f=s.vsBot,d=it(),p="line-through",b=Object(m.useState)({you:p,opponent:u||f?"":p}),O=Object(a.a)(b,2),x=O[0],M=O[1],T=Object(m.useState)(),I=Object(a.a)(T,2),D=I[0],G=I[1],W=Object(m.useState)(),P=Object(a.a)(W,2),R=P[0],J=P[1],F=Object(m.useState)({open:!1,title:""}),U=Object(a.a)(F,2),Y=U[0],X=U[1],q=Object(m.useState)({you:0,opponent:0}),K=Object(a.a)(q,2),Q=K[0],V=K[1],Z=Object(m.useState)(z.newBoard(!0)),$=Object(a.a)(Z,2),_=$[0],et=$[1],at=Object(m.useState)(z.newBoard()),ot=Object(a.a)(at,2),ct=ot[0],st=ot[1],ut=Object(m.useState)(),lt=Object(a.a)(ut,2),ht=lt[0],jt=lt[1];Object(m.useEffect)((function(){return l||o.push("/"),e(f?" ":l),L.on("ready",(function(t,e){M((function(t){return Object(y.a)(Object(y.a)({},t),{},{opponent:""})})),t&&J(e)})),L.on("leave",(function(){L.emit("not ready"),M({you:p,opponent:p}),G(),J(),V({you:0,opponent:0}),X({open:!0,title:"".concat(f?"Bot":"Opponent"," left")})})),L.emit("join alert"),L.on("join alert",(function(){jt(!0),setTimeout((function(){jt()}),3e3)})),function(){e(),r(),i(),L.removeAllListeners(),L.emit("leave")}}),[]),Object(m.useEffect)((function(){n||o.push("/")}),[n]),Object(m.useEffect)((function(){tt.setBotData({matrixTrack:z.newBoard(),shipArr:Object(v.a)(z.shipArr)}),Q.lastWinner&&(L.emit("not ready"),M({you:p,opponent:f?"":p}),X({open:!0,title:"".concat(Q.lastWinner," won")}))}),[Q]);var ft=function(){et(z.newBoard(!0)),st(z.newBoard()),G(),J(),X({open:!1,title:""})};return Object(nt.jsxs)(g.a,{container:!0,className:d.root,spacing:2,children:[Object(nt.jsx)(g.a,{item:!0,xs:12,children:Object(nt.jsxs)(g.a,{container:!0,justify:"center",spacing:10,children:[Object(nt.jsxs)(g.a,{item:!0,children:[Object(nt.jsx)(h.a,{style:{textDecoration:x.you},children:"Ready"}),Object(nt.jsxs)(h.a,{children:["You (",Q.you,")"]}),Object(nt.jsx)(rt,{className:d.battlefield,isMyBoard:!0,matrix:_,setMyMatrix:et,setTurn:J,setScore:V}),Object(nt.jsx)(j.a,{variant:"outlined",onClick:function(){L.emit("ready",_,f&&z.newBoard(!0),(function(t,e){M((function(t){return Object(y.a)(Object(y.a)({},t),{},{you:""})})),G(!0),(t||f)&&J(e)}))},disabled:D,children:"Start"}),Object(nt.jsx)(k.a,{title:"New board",children:Object(nt.jsx)(w.a,{color:"primary",disabled:D,onClick:function(){return et(z.newBoard(!0))},children:Object(nt.jsx)(C.a,{})})})]}),!0===R&&Object(nt.jsx)(E.a,{className:d.arrow}),!1===R&&Object(nt.jsx)(N.a,{className:d.arrow}),Object(nt.jsxs)(g.a,{item:!0,children:[Object(nt.jsx)(h.a,{style:{textDecoration:x.opponent},children:"Ready"}),Object(nt.jsxs)(h.a,{children:[f?"Bot":"Opponent"," (",Q.opponent,")"]}),Object(nt.jsx)(rt,{className:d.battlefield,turn:R,setTurn:J,matrix:ct,setOpponentMatrix:st,setScore:V,vsBot:f,setMyMatrix:et}),ht&&Object(nt.jsx)(H.a,{severity:"success",children:"Opponent joined"})]})]})}),Object(nt.jsxs)(B.a,{open:Y.open,onClose:ft,children:[Object(nt.jsx)(A.a,{children:Y.title}),Object(nt.jsx)(S.a,{children:Object(nt.jsx)(j.a,{onClick:ft,color:"primary",autoFocus:!0,children:"Close"})})]})]})},ot=n(214),ct=Object(M.a)((function(t){return{paper:{marginTop:t.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},form:{width:"100%",marginTop:t.spacing(1)},newGameBtn:{margin:t.spacing(3,0,2)}}})),st=function(t,e,n,r){L.emit("new game",(function(i){e(!0),n||r(!0),t.push({pathname:"/game",gameId:i,vsBot:n})}))},ut=function(t,e,n,r,i){L.emit("join",t,(function(a,o){if(a)return n(a);r(!0),i(!0),e.push({pathname:"/game",gameId:t,isOpponentReady:o,vsBot:!1})}))},lt=function(t){var e=t.setExitBtn,n=t.setShowGameId,r=Object(m.useState)(""),i=Object(a.a)(r,2),o=i[0],u=i[1],l=Object(m.useState)(),h=Object(a.a)(l,2),d=h[0],p=h[1],b=Object(c.f)(),O=ct();return Object(nt.jsxs)(f.a,{component:"main",maxWidth:"xs",children:[Object(nt.jsx)(s.a,{}),Object(nt.jsx)("div",{className:O.paper,children:Object(nt.jsxs)("form",{className:O.form,children:[Object(nt.jsxs)(g.a,{container:!0,spacing:2,style:{marginTop:10},children:[Object(nt.jsx)(g.a,{item:!0,xs:6,children:Object(nt.jsx)(ot.a,{variant:"outlined",fullWidth:!0,label:"Game Id",value:o,onChange:function(t){return u(t.target.value)}})}),Object(nt.jsx)(g.a,{item:!0,xs:6,children:Object(nt.jsx)(j.a,{variant:"outlined",fullWidth:!0,label:"Join",style:{height:55},onClick:function(){return ut(o,b,p,e,n)},children:"Join"})})]}),Object(nt.jsx)(j.a,{fullWidth:!0,variant:"contained",color:"primary",className:O.newGameBtn,onClick:function(){return st(b,e,!1,n)},children:"New game"}),Object(nt.jsx)(j.a,{onClick:function(){return st(b,e,!0)},style:{marginTop:"6px",backgroundColor:"black",width:"inherit"},children:Object(nt.jsx)("i",{className:"fas fa-robot",style:{fontSize:"30px",color:"white"}})})]})}),Object(nt.jsx)("div",{style:{marginTop:"20px"},children:d&&Object(nt.jsx)(H.a,{severity:"error",children:d})})]})};var ht=function(){var t=Object(m.useState)(),e=Object(a.a)(t,2),n=e[0],r=e[1],i=Object(m.useState)(),p=Object(a.a)(i,2),O=p[0],v=p[1],y=Object(m.useState)(),g=Object(a.a)(y,2),k=g[0],w=g[1];return Object(m.useEffect)((function(){return function(){return L.disconnect()}}),[]),Object(nt.jsxs)(nt.Fragment,{children:[Object(nt.jsx)(s.a,{}),Object(nt.jsx)(u.a,{position:"static",children:Object(nt.jsxs)(l.a,{children:[Object(nt.jsx)(b.a,{}),Object(nt.jsx)(h.a,{variant:"h6",children:"Battleship"}),k&&Object(nt.jsx)(j.a,{variant:"contained",color:"default",startIcon:Object(nt.jsx)(x.a,{}),style:{marginLeft:"auto"},onClick:function(){return w()},children:"Exit"})]})}),Object(nt.jsx)("main",{children:Object(nt.jsx)("div",{children:Object(nt.jsxs)(f.a,{maxWidth:"sm",children:[Object(nt.jsx)(h.a,{variant:"h2",align:"center",color:"textPrimary",gutterBottom:!0,children:"Battleship"}),n&&Object(nt.jsxs)(h.a,{variant:"h5",align:"center",color:"textPrimary",gutterBottom:!0,style:{visibility:O?"visible":"hidden"},children:["Game Id: ",n]}),Object(nt.jsx)(d.a,{children:Object(nt.jsx)(o.a,{children:Object(nt.jsxs)(c.c,{children:[Object(nt.jsx)(c.a,{exact:!0,path:"/",children:Object(nt.jsx)(lt,{setExitBtn:w,setShowGameId:v})}),Object(nt.jsx)(c.a,{exact:!0,path:"/game",children:Object(nt.jsx)(at,{setGameId:r,exitBtn:k,setExitBtn:w,setShowGameId:v})})]})})})]})})})]})};i.a.render(Object(nt.jsx)(ht,{}),document.getElementById("root"))}},[[166,1,2]]]);
//# sourceMappingURL=main.17a7e826.chunk.js.map